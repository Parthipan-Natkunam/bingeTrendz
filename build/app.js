function makeTMDBCall(){document.getElementById("load_spinner").style.display="block";var e=getCachedData(),t=(new Date).getTime()-e.refetchTime<0;e.result&&t?showData(e.result):tmdb.call("/trending",{media_type:"tv",time_window:"day"},function(e){showData(e),setDataToLocalStore(e.results)},function(t){if(e&&e.result)return showData(e.result),void ShowNotification({type:"warning",message:"Failed to fetch latest results. Showing older reults."});ShowNotification({type:"error",message:"Something went wrong. Please try again later."})})}function setDateTime(){var e=document.getElementById("date-card__date"),t=document.getElementById("date-card__time"),n=new Date,a=formatDateString(n.getDate(),n.getMonth(),n.getFullYear()),i=formatTimeString(n.getHours(),n.getMinutes());e.innerText=a,t.innerText=i}function formatDateString(e,t,n){var a;return 1===(e=""+e).length&&(e="0"+e),e+" "+(t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t])+" "+((a=(""+n).split(""))[2]+a[3])}function formatTimeString(e,t){var n="AM";return e>12?(n="PM",e-=12):0===e&&(e=12,n="AM"),1===(t=""+t).length&&(t="0"+t),(e=""+e)+":"+t+" "+n}function setBackdropImg(e){var t=document.getElementById("base__cover"),n=document.getElementById("load_spinner"),a=selectImage(e);fullImgURI="url('"+tmdb.images_uri+"/w500/"+a,t.style.backgroundImage=fullImgURI,n.style.display="none"}function selectImage(e){return e.length?e[Math.floor(Math.random()*e.length)]:""}function showData(e){e.results=e.results||e,setBackdropImg(e.results.map(function(e){return e.backdrop_path})),generateTemplate(e.results)}function generateTemplate(e){var t="";e.forEach(function(e,n){t+=`<div class="series-list__card">\n                        <span class="trend-rank">${n+1}</span>\n                        <img src="http://image.tmdb.org/t/p/w200/${e.poster_path}"/>\n                        <h3 class="series-name">${e.name}</h3>\n                        <p title="${e.overview}" class="series-overview">${e.overview}</p>\n                        <p class="series-lang">Original Language: <span>${e.original_language}</span></p>\n                    </div>`}),document.getElementById("series-list").innerHTML=t}function ShowNotification(e){var t=`<div class="notification ${e.type}">\n                             <p>${e.message} <span id="notification_close">&times;</span></p>\n                           </div>`,n=document.getElementsByClassName("full-cover__conatiner")[0],a=generateDOMElement(t),i=document.getElementsByClassName("date-card")[0];n.insertBefore(a,i),document.getElementById("notification_close").addEventListener("click",function(e){a.remove()})}function generateDOMElement(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstElementChild}function setDataToLocalStore(e){if(window.localStorage)try{window.localStorage.setItem("bingeTdz_cache",JSON.stringify(e));var t=(new Date).getTime()+432e5;window.localStorage.setItem("bingeTdz_refetchTime",t)}catch(e){ShowNotification({type:"error",message:"Failed to cache results. Please enable LocalStorage to improve preformance."})}}function getCachedData(){var e=window.localStorage.getItem("bingeTdz_cache");e&&(e=JSON.parse(e));var t=window.localStorage.getItem("bingeTdz_refetchTime");return{result:e,refetchTime:t=isNaN(+t)?0:+t}}window.tmdb={api_key:"47729872a52678aftb63789",base_uri:"http://api.themoviedb.org/3",images_uri:"http://image.tmdb.org/t/p",timeout:5e3,call:function(e,t,n,a){var i="";for(var r in t)t.hasOwnProperty(r)&&(i+="/"+encodeURIComponent(t[r]));i+="?api_key="+tmdb.api_key;var o=new XMLHttpRequest;o.timeout=tmdb.timeout,o.ontimeout=function(){throw"Request timed out: "+e+" "+i},o.open("GET",tmdb.base_uri+e+i,!0),o.setRequestHeader("Accept","application/json"),o.responseType="text",o.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){if("function"!=typeof n)throw"No success callback, but the request gave results";n(JSON.parse(this.response))}else{if("function"!=typeof a)throw"No error callback";a(JSON.parse(this.response))}},o.send()}},setDateTime(),makeTMDBCall(),document.getElementById("list__fab").addEventListener("click",function(){var e=document.getElementById("series-list");"none"===e.style.display||""===e.style.display?e.style.display="inline-block":e.style.display="none"}),setInterval(setDateTime,6e4);