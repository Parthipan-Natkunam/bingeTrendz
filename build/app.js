function makeLambdaCall(){document.getElementById("load_spinner").style.display="block";var e=getCachedData(),t=(new Date).getTime()-e.refetchTime<0;e.result&&t?showData(e.result):lambda.call(function(e){showData(e),setDataToLocalStore(e.results)},function(t){if(e&&e.result)return showData(e.result),void ShowNotification({type:"warning",message:"Failed to fetch latest results. Showing older reults."});ShowNotification({type:"error",message:"Something went wrong. Please try again later."})})}function setDateTime(){var e=document.getElementById("date-card__date"),t=document.getElementById("date-card__time"),a=new Date,n=formatDateString(a.getDate(),a.getMonth(),a.getFullYear()),i=formatTimeString(a.getHours(),a.getMinutes());e.innerText=n,t.innerText=i}function formatDateString(e,t,a){var n;return 1===(e=""+e).length&&(e="0"+e),e+" "+(t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t])+" "+((n=(""+a).split(""))[2]+n[3])}function formatTimeString(e,t){var a="AM";return e>12?(a="PM",e-=12):0===e&&(e=12,a="AM"),1===(t=""+t).length&&(t="0"+t),(e=""+e)+":"+t+" "+a}function setBackdropImg(e){var t=document.getElementById("base__cover"),a=document.getElementById("load_spinner"),n=selectImage(e);fullImgURI="url('"+lambda.images_uri+"/w500/"+n,t.style.backgroundImage=fullImgURI,a.style.display="none"}function selectImage(e){return e.length?e[Math.floor(Math.random()*e.length)]:""}function showData(e){var t=e.results?e.results:e;setBackdropImg(t.map(function(e){return e.backdrop_path})),generateTemplate(t)}function generateTemplate(e){var t="";e.forEach(function(e,a){t+=`<div class="series-list__card">\n                        <span class="trend-rank">${a+1}</span>\n                        <img src="http://image.tmdb.org/t/p/w200/${e.poster_path}"/>\n                        <h3 class="series-name">${e.name}</h3>\n                        <p title="${e.overview}" class="series-overview">${e.overview}</p>\n                        <p class="series-lang">Original Language: <span>${e.original_language}</span></p>\n                    </div>`}),document.getElementById("series-list").innerHTML=t}function ShowNotification(e){var t=`<div class="notification ${e.type}">\n                             <p>${e.message} <span id="notification_close">&times;</span></p>\n                           </div>`,a=document.getElementsByClassName("full-cover__conatiner")[0],n=generateDOMElement(t),i=document.getElementsByClassName("date-card")[0];a.insertBefore(n,i),document.getElementById("notification_close").addEventListener("click",function(e){n.remove()})}function generateDOMElement(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstElementChild}function setDataToLocalStore(e){if(window.localStorage)try{window.localStorage.setItem("bingeTdz_cache",JSON.stringify(e));var t=(new Date).getTime()+432e5;window.localStorage.setItem("bingeTdz_refetchTime",t)}catch(e){ShowNotification({type:"error",message:"Failed to cache results. Please enable LocalStorage to improve preformance."})}}function getCachedData(){var e=window.localStorage.getItem("bingeTdz_cache");e&&(e=JSON.parse(e));var t=window.localStorage.getItem("bingeTdz_refetchTime");return{result:e,refetchTime:t=isNaN(+t)?0:+t}}window.lambda={images_uri:"http://image.tmdb.org/t/p",timeout:5e3,url:"https://fnoi0v7owa.execute-api.us-east-1.amazonaws.com/dev/list",call:function(e,t){var a=new XMLHttpRequest;a.timeout=lambda.timeout,a.ontimeout=function(){throw"Request timed out"},a.open("GET",lambda.url,!0),a.setRequestHeader("Accept","application/json"),a.responseType="text",a.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){if("function"!=typeof e)throw"No success callback, but the request gave results";e(JSON.parse(this.response))}else{if("function"!=typeof t)throw"No error callback";try{t(JSON.parse(this.response))}catch(e){t({error:"XMLHttpRequest Failed"})}}},a.send()}},setDateTime(),makeLambdaCall(),document.getElementById("list__fab").addEventListener("click",function(){var e=document.getElementById("series-list");"none"===e.style.display||""===e.style.display?e.style.display="inline-block":e.style.display="none"}),setInterval(setDateTime,6e4);